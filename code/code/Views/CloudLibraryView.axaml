<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:code.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="720"
             x:Class="code.Views.CloudLibraryView"
             x:Name="CloudLibraryRoot"
             x:DataType="vm:CloudLibraryViewModel">

  <Design.DataContext>
    <!-- ViewModel now handles its own design-time data via parameterless constructor -->
    <vm:CloudLibraryViewModel />
  </Design.DataContext>

  <Grid Background="#0F0F0F">
    <Grid RowDefinitions="Auto,*,Auto" Margin="24">
      <!-- Header Row -->
      <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,16">
        <Button
          Content="Back"
          Command="{Binding NavigateBackCommand}"
          Width="64"
          Height="32"
          FontWeight="SemiBold"
          Background="#2E2E2E"
          Foreground="White"
          Padding="8,4"
          CornerRadius="6"
          HorizontalAlignment="Left"/>
        <TextBlock
          Grid.Column="1"
          Text="Cloud Library"
          Foreground="White"
          FontSize="18"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"/>
        <!-- Optional: Add a refresh button or loading indicator here -->
        <Button Grid.Column="2" Content="Refresh" Command="{Binding LoadCloudsCommand}" IsVisible="{Binding !IsLoading}" HorizontalAlignment="Right" Background="#2E2E2E" Foreground="White" Padding="8,4" CornerRadius="6" />
        <ProgressBar Grid.Column="2" IsIndeterminate="True" IsVisible="{Binding IsLoading}" Width="100" HorizontalAlignment="Right" />
      </Grid>

      <!-- Status Message -->
      <TextBlock Grid.Row="1" Text="{Binding StatusMessage}" Foreground="OrangeRed" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,10,0,0" IsVisible="{Binding IsStatusMessageVisible}"/>

      <!-- Main Content: Cloud Cards or Loading/Status -->
      <Panel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center">
        <ItemsControl ItemsSource="{Binding CloudItems}"
                      IsVisible="{Binding AreCloudItemsVisible}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <UniformGrid Columns="2" Rows="2" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,24,0,0" ColumnSpacing="64" RowSpacing="32"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:CloudItemViewModel">
              <Border Background="#1E1E1E" CornerRadius="12" Padding="24" Width="370" Height="200">
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>
                  <TextBlock Text="{Binding Name}" FontSize="20" FontWeight="Bold" Margin="0,0,0,4" Foreground="White"/>
                  <StackPanel Grid.Row="1" Margin="0,0,90,0" Spacing="4">
                    <TextBlock FontSize="14" Foreground="#AAA" TextWrapping="Wrap">
                        <Run Text="Type: " FontWeight="SemiBold"/><Run Text="{Binding CloudTypeString}"/>
                    </TextBlock>
                    <TextBlock FontSize="14" Foreground="#AAA" TextWrapping="Wrap">
                        <Run Text="Created: " FontWeight="SemiBold"/><Run Text="{Binding CreatedAtDisplay}"/>
                    </TextBlock>
                     <!-- Add more cloud properties here if needed -->
                  </StackPanel>
                  <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Left" Margin="0,10,0,0">
                    <Button Content="Display"
                            Command="{Binding DataContext.DisplayCloudCommand, ElementName=CloudLibraryRoot}"
                            CommandParameter="{Binding}"
                            HorizontalContentAlignment="Center"
                            Width="72"
                            Background="#2E2E2E" Foreground="White" Padding="8,4" CornerRadius="6"/>
                    <Button Content="Delete"
                            Command="{Binding DataContext.DeleteCloudCommand, ElementName=CloudLibraryRoot}"
                            CommandParameter="{Binding}"
                            HorizontalContentAlignment="Center"
                            Width="72"
                            Background="#552222" Foreground="White" Padding="8,4" CornerRadius="6"/>
                  </StackPanel>
                  <Border Width="70" Height="70" BorderBrush="#333" BorderThickness="1" CornerRadius="8"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Bottom"
                          Grid.RowSpan="3"
                          Margin="0,0,8,8"
                          IsVisible="{Binding PreviewImage, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <Image Source="{Binding PreviewImage}" Stretch="UniformToFill"/>
                     <!-- Fallback or placeholder if PreviewImage is null -->
                  </Border>
                  <Border Background="#2A2A2A" Width="70" Height="70" CornerRadius="8"
                          HorizontalAlignment="Right" VerticalAlignment="Bottom" Grid.RowSpan="3" Margin="0,0,8,8"
                          IsVisible="{Binding PreviewImage, Converter={x:Static ObjectConverters.IsNull}}">
                        <TextBlock Text="No Preview" Foreground="#777" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center"/>
                  </Border>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </Panel>

      <!-- Pagination Controls (Bottom Row) -->
      <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,32,0,0" Spacing="8" IsVisible="{Binding IsPaginationVisible}">
        <Button Content="&#x2190; Previous" Command="{Binding PreviousPageCommand}" Background="#2E2E2E" Foreground="White" Padding="8,4" CornerRadius="6"/>
        
        <!-- Simple Page Number Display -->
        <TextBlock Text="{Binding CurrentPage, StringFormat='Page {0}'}" Foreground="#AAA" VerticalAlignment="Center"/>
        <TextBlock Text="of" Foreground="#888" VerticalAlignment="Center"/>
        <TextBlock Text="{Binding TotalPages}" Foreground="#AAA" VerticalAlignment="Center"/>
        

        <Button Content="Next &#x2192;" Command="{Binding NextPageCommand}" Background="#2E2E2E" Foreground="White" Padding="8,4" CornerRadius="6"/>
      </StackPanel>
    </Grid>
  </Grid>
</UserControl>
